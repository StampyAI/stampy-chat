# run multiple dev servers in parallel
# run with:
# cargo install mprocs || npm install -g mprocs || yay mprocs
# mprocs
procs:
  api:
    shell: cd api && pipenv run python main.py
    env:
      FLASK_ENV: development
    autostart: true
    autorestart: true
  mcp:
    shell: cd api && pipenv run python mcp_server.py
    autostart: true
    autorestart: true
  web:
    shell: cd web && npm run dev
    autostart: true
    autorestart: true
  caddy:
    shell: 'if [ -e Caddyfile ] && which caddy; then sed -i ''s/[0-9]\+\.[0-9]\+\.[0-9]\+\.[0-9]\+/''"$(curl checkip.amazonaws.com | grep --only-matching ''[0-9]\+\.[0-9]\+\.[0-9]\+\.[0-9]\+'')"''/'' Caddyfile; caddy run; fi'
    autostart: true
    autorestart: true
  ui:
    shell: 'if [ -e ../stampy-ui ]; then cd ../stampy-ui && npm run dev; elif [ -e stampy-ui ]; then cd stampy-ui && npm run dev; fi'
    autostart: true
    autorestart: true

# Optional: specify shell to use
shell: bash

# Optional: hide keybindings pane at bottom
hide_keymap_window: false

# Optional: increase scrollback buffer
scrollback: 50000
